{
    "rules": {
        "presence": {
            "$userId": {
                ".write": "auth != null && auth.uid === $userId",
                ".read": "auth != null",
                ".validate": "newData.hasChildren(['state', 'lastChanged'])",
                "state": {
                    ".validate": "newData.isString() && (newData.val() === 'online' || newData.val() === 'offline' || newData.val() === 'away')"
                },
                "lastChanged": {
                    ".validate": "newData.val() <= now"
                },
                "lastSeen": {
                    ".validate": "newData.val() <= now"
                },
                "deviceType": {
                    ".validate": "newData.isString() && newData.val().length <= 50"
                }
            }
        },
        "typing": {
            "$conversationId": {
                "$userId": {
                    ".write": "auth != null && auth.uid === $userId",
                    ".read": "auth != null",
                    ".validate": "newData.hasChildren(['isTyping', 'timestamp'])",
                    "isTyping": {
                        ".validate": "newData.isBoolean()"
                    },
                    "timestamp": {
                        ".validate": "newData.val() <= now"
                    }
                }
            }
        },
        "seismic_reports": {
            ".write": "auth != null",
            ".read": "auth != null",
            "$reportId": {
                ".validate": "newData.hasChildren(['userId', 'timestamp', 'location', 'detection'])",
                "userId": {
                    ".validate": "newData.isString() && newData.val().length > 0"
                },
                "timestamp": {
                    ".validate": "newData.isNumber() && newData.val() <= now"
                },
                "location": {
                    "latitude": {
                        ".validate": "newData.isNumber() && newData.val() >= -90 && newData.val() <= 90"
                    },
                    "longitude": {
                        ".validate": "newData.isNumber() && newData.val() >= -180 && newData.val() <= 180"
                    }
                },
                "detection": {
                    "peakAcceleration": {
                        ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 10"
                    },
                    "confidence": {
                        ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 1"
                    },
                    "duration": {
                        ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 300000"
                    }
                }
            }
        },
        "active_events": {
            ".read": true,
            ".write": "auth != null && auth.token.admin === true",
            ".indexOn": [
                "lastUpdateTime"
            ],
            "$eventId": {
                ".validate": "newData.hasChildren(['id', 'epicenter', 'reportCount'])"
            }
        },
        "user_settings": {
            "$userId": {
                ".read": "auth != null && auth.uid === $userId",
                ".write": "auth != null && auth.uid === $userId"
            }
        },
        "rate_limits": {
            "$userId": {
                ".read": "auth != null && auth.uid === $userId",
                ".write": "auth != null && auth.uid === $userId && (!data.exists() || data.val() < now - 5000)"
            }
        },
        ".read": false,
        ".write": false
    }
}